Last updated: 2026-01-12

# Project Overview

## プロジェクト概要
- GitHub Copilotによる自動実装PRのフェーズを監視するPythonツールです。
- 認証済みGitHubユーザーの所有リポジトリを対象に、効率的なPR管理を支援します。
- フェーズに応じた自動アクション、通知、そしてオプションの自動マージ機能を提供します。

## 技術スタック
- フロントエンド:
    -   **Selenium**: Webブラウザを自動操縦するためのフレームワーク。PRの自動マージやIssueのCopilotへの自動割り当て機能で、ブラウザ経由の操作を自動化するために利用されます。
    -   **Playwright**: Microsoftが開発した、ブラウザ自動操縦のための高速で信頼性の高いフレームワーク。Seleniumの代替として、同様の自動化タスクに利用されます。
- 音楽・オーディオ: なし
- 開発ツール:
    -   **GitHub CLI (`gh`)**: GitHubの公式コマンドラインインターフェースツール。認証、リポジトリのクローン、PR情報の取得など、GitHubとの連携に利用されます。
    -   **.editorconfig**: 異なるエディタやIDEを使用する開発者間で、インデントスタイルや文字コードなどのコーディングスタイルを統一するための設定ファイルです。
    -   **ruff**: Pythonコードのリンティング（静的解析）と自動フォーマットを非常に高速に実行するツール。コードの品質と一貫性を維持するために使用されます。
    -   **TOML**: `config.toml`ファイルで使用されている設定ファイル形式。人間が読みやすく、キーバリューペア構造を持つデータシリアライゼーション言語です。
- テスト:
    -   **pytest**: Pythonアプリケーションのテストを記述し、実行するための広く使われているテストフレームワーク。プロジェクトの各機能の単体テストや結合テストに利用されます。
- ビルドツール: なし (Pythonプロジェクトのため、通常は`pip`がパッケージ管理に使用されますが、明示的なビルドツールは記述されていません。)
- 言語機能:
    -   **Python 3.x**: プロジェクトの主要な実装言語。堅牢なスクリプト機能と豊富なライブラリにより、GitHub APIとの連携やロジックの実装が行われています。
    -   **GraphQL API**: GitHubのAPIから、REST APIよりも効率的に必要なデータのみをクエリするための言語。PR情報の取得など、データフェッチの効率化に貢献しています。
- 自動化・CI/CD:
    -   **GitHub API (GraphQL)**: GitHubリポジトリからプルリクエストのステータス、コメント、その他の詳細情報を取得し、コメント投稿やPRステータス変更などのアクションを実行するために利用されます。
    -   **ntfy.sh**: プッシュ通知サービス。特定のイベント（例: PRがレビュー待ちフェーズに移行）が発生した際に、モバイルデバイスなどへ通知を送信するために利用されます。
    -   **GitHub Copilot**: AIによるコード自動生成や、プルリクエストに対するレビューコメントの自動生成を支援するツール。このプロジェクトは、Copilotが関与するPRのライフサイクルを監視することを目的としています。
- 開発標準:
    -   **ruff**: Pythonコードのフォーマットとリンティングにより、コードの一貫性と品質を強制し、開発標準を維持します。
    -   **.editorconfig**: 開発環境全体でのコードスタイルの統一に貢献します。

## ファイル階層ツリー
```
cat-github-watcher/
├── cat-github-watcher.py    # エントリーポイント
├── src/
│   └── gh_pr_phase_monitor/
│       ├── colors.py         # ANSI カラーコードと色付け
│       ├── config.py         # 設定の読み込みと解析
│       ├── github_client.py  # GitHub API 連携
│       ├── phase_detector.py # PRフェーズ判定ロジック
│       ├── comment_manager.py # コメント投稿と確認
│       ├── pr_actions.py     # PRアクション（Ready化、ブラウザ起動）
│       └── main.py           # メイン実行ループ
└── tests/                    # テストファイル
```

## ファイル詳細説明
-   `.editorconfig`: 異なる開発環境間でコードのインデントスタイル、文字コードなどを統一するための設定ファイルです。
-   `.gitignore`: Gitのバージョン管理から除外するファイルやディレクトリを指定するファイルです。
-   `.vscode/settings.json`: Visual Studio Codeエディタ固有の設定ファイルで、プロジェクトのワークスペース設定を定義します。
-   `LICENSE`: プロジェクトのライセンス情報（MIT License）を記載したファイルです。
-   `MERGE_CONFIGURATION_EXAMPLES.md`: 自動マージ機能の設定例を説明するドキュメントです。
-   `PHASE3_MERGE_IMPLEMENTATION.md`: フェーズ3での自動マージの実装に関する詳細を記述したドキュメントです。
-   `README.ja.md`, `README.md`: プロジェクトの概要、機能、使用方法などを記述した、日本語版と英語版のメインドキュメントです。
-   `STRUCTURE.md`: プロジェクトのディレクトリ構成や全体構造に関する説明ドキュメントです。
-   `_config.yml`: GitHub Pagesなどの静的サイトジェネレータで利用される可能性のある設定ファイルです。
-   `cat-github-watcher.py`: プロジェクトのメインエントリーポイントであり、設定の読み込みと監視ループの開始を担当します。
-   `config.toml.example`: アプリケーションの設定ファイル (`config.toml`) のサンプルであり、ユーザーがコピーして編集するためのテンプレートです。
-   `demo_automation.py`: ブラウザ自動操縦機能のデモンストレーション用スクリプトです。
-   `demo_comparison.py`: 何らかの比較機能のデモンストレーション用スクリプトです。
-   `docs/`: プロジェクトに関する追加のドキュメントやガイドを格納するディレクトリです。
    -   `IMPLEMENTATION_SUMMARY.ja.md`, `IMPLEMENTATION_SUMMARY.md`: 実装の概要をまとめた日本語版と英語版のドキュメントです。
    -   `PR67_IMPLEMENTATION.md`: 特定のプルリクエスト（PR67）の実装に関する詳細を記述したドキュメントです。
    -   `RULESETS.md`: 監視ルールセットに関する説明ドキュメントです。
    -   `VERIFICATION_GUIDE.en.md`, `VERIFICATION_GUIDE.md`: 検証ガイドの英語版と日本語版です。
    -   `browser-automation-approaches.en.md`, `browser-automation-approaches.md`: ブラウザ自動操縦のアプローチに関する英語版と日本語版のドキュメントです。
-   `generated-docs/`: AIなどによって自動生成されたドキュメントを格納するディレクトリです。
-   `pytest.ini`: `pytest`フレームワークの実行に関する設定を定義するファイルです。
-   `requirements-automation.txt`: ブラウザ自動操縦機能を利用する際に必要となるPythonパッケージとそのバージョンをリストアップしたファイルです。
-   `ruff.toml`: `ruff`リンターのコードスタイル、ルール、および設定を定義するファイルです。
-   `src/`: プロジェクトのソースコードを格納するディレクトリです。
    -   `__init__.py`: Pythonパッケージであることを示します。
    -   `gh_pr_phase_monitor/`: プロジェクトのコアロジックを格納する主要なパッケージです。
        -   `__init__.py`: Pythonパッケージであることを示します。
        -   `browser_automation.py`: SeleniumやPlaywrightといったライブラリを使用して、Webブラウザを自動操作する機能（例: PRの自動マージ、IssueのCopilotへの自動割り当て）を提供します。
        -   `colors.py`: ターミナル出力を見やすくするために、ANSIカラーコードを適用してテキストに色を付けるユーティリティ関数を提供します。
        -   `comment_fetcher.py`: 指定されたプルリクエストからコメント履歴を取得するための機能を提供します。
        -   `comment_manager.py`: プルリクエストへのコメント投稿を管理し、特定のコメントが存在するかどうかの確認を行います。
        -   `config.py`: `config.toml`ファイルからアプリケーションの設定を読み込み、解析し、実行時に利用可能な形で管理します。
        -   `github_auth.py`: GitHub CLIを利用してGitHubへの認証を行い、APIアクセスに必要なトークンなどを管理します。
        -   `github_client.py`: GitHub REST APIとの連携を担当し、リポジトリ情報やプルリクエストの状態取得、コメント投稿といった操作を行います。
        -   `graphql_client.py`: GitHub GraphQL APIを利用して、REST APIよりも効率的に大量のデータを取得するためのクライアント機能を提供します。
        -   `issue_fetcher.py`: GitHubリポジトリからIssueの情報を取得する機能を提供します。
        -   `main.py`: 監視プロセスのメインループを実装し、各モジュールを連携させて一連のPR監視・アクション処理をオーケストレートします。
        -   `notifier.py`: ntfy.shサービスを通じて、モバイルデバイスなどへのプッシュ通知を送信する機能を提供します。
        -   `phase_detector.py`: プルリクエストの状態を分析し、特定の「フェーズ」（Draft、レビュー指摘対応中、レビュー待ち、LLM作業中など）を判定するロジックを実装しています。
        -   `pr_actions.py`: プルリクエストに対する具体的なアクション（Draft PRのReady化、PRページのブラウザ起動、自動マージなど）を実行する機能を提供します。
        -   `pr_fetcher.py`: GitHubリポジトリからオープンなプルリクエストのリストとその詳細情報を取得する機能を提供します。
        -   `repository_fetcher.py`: 認証済みGitHubユーザーが所有するリポジトリの一覧を取得する機能を提供します。
-   `tests/`: プロジェクトの各モジュールおよび機能に対するpytestベースの自動テストコードを格納しています。

## 関数詳細説明
このプロジェクトは、単一責任の原則に従ってモジュール化されており、各ファイルが特定の機能群を担っています。具体的な関数の引数や戻り値は提供されていませんが、各モジュールの説明から、以下のような役割を持つ関数が含まれると推測されます。

-   `browser_automation.py`: Webブラウザの起動、特定のURLへの移動、HTML要素の検索とクリック、テキスト入力など、ブラウザをプログラム的に操作するための関数群。
-   `colors.py`: 指定されたテキストにANSIカラーコードを適用し、色付きの文字列を生成するためのユーティリティ関数。
-   `comment_fetcher.py`: 特定のプルリクエストIDまたはURLに基づいて、関連するコメントをGitHub APIから取得するための関数群。
-   `comment_manager.py`: プルリクエストにコメントを投稿したり、既存のコメントを検索・確認したりするための関数群。
-   `config.py`: TOML形式の設定ファイルを読み込み、解析し、アプリケーション全体で利用可能な設定オブジェクトとして提供するための関数群。
-   `github_auth.py`: GitHub CLIを利用してGitHubへの認証プロセスを管理し、APIアクセスのためのトークンを取得・更新するための関数群。
-   `github_client.py`: GitHub REST APIエンドポイントに対してHTTPリクエストを送信し、リポジトリ、プルリクエスト、ユーザーなどの情報を取得したり、変更を送信したりするための関数群。
-   `graphql_client.py`: GitHub GraphQL APIに対するクエリを構築し、実行し、その結果を処理するための関数群。
-   `issue_fetcher.py`: 特定のリポジトリからIssueのリストや詳細情報を取得するための関数群。
-   `main.py`: アプリケーションのメインループを定義し、設定の初期化、リポジトリの監視、PR情報のフェッチ、フェーズ判定、アクションの実行といった一連の処理をオーケストレートする関数。
-   `notifier.py`: ntfy.shサービスと連携し、指定されたトピックに対して通知メッセージを送信するための関数群。
-   `phase_detector.py`: プルリクエストの各種属性（例: ドラフト状態、レビューコメント、ラベル）を分析し、現在のフェーズ（phase1, phase2, phase3, LLM working）を判定するためのロジックを実装した関数群。
-   `pr_actions.py`: プルリクエストに対して具体的なアクション（例: ドラフトPRをReadyにする、特定のコメントを投稿する、PRをマージする）を実行するための関数群。
-   `pr_fetcher.py`: GitHubリポジトリからオープンなプルリクエストのリストとその詳細情報を取得するための関数群。
-   `repository_fetcher.py`: 認証済みGitHubユーザーが所有するリポジトリの一覧を取得するための関数群。

## 関数呼び出し階層ツリー
```
提供されたプロジェクト情報からは、具体的な関数呼び出し階層ツリーを分析できませんでした。
しかし、プロジェクトの構造から、`cat-github-watcher.py`または`src/gh_pr_phase_monitor/main.py`がアプリケーションの主要なエントリーポイントとして機能し、そこから以下の流れで他のモジュール内の関数が呼び出されると推測されます。

1. **設定の読み込み**: `config.py`が`config.toml`を読み込む。
2. **リポジトリの取得**: `repository_fetcher.py`がユーザー所有リポジトリをフェッチ。
3. **PRの取得**: 各リポジトリについて`pr_fetcher.py`がプルリクエスト情報を取得（`graphql_client.py`や`github_client.py`を利用）。
4. **フェーズ判定**: 各PRに対して`phase_detector.py`がフェーズを判定（`comment_fetcher.py`などを利用）。
5. **アクションの実行**: フェーズに応じて`pr_actions.py`がアクション（例: PR Ready化、コメント投稿、通知送信）を実行（`comment_manager.py`, `notifier.py`, `browser_automation.py`などを利用）。
6. **Issueの表示**: 全PRが特定の状態の場合、`issue_fetcher.py`がIssue情報を取得。

この一連の処理がメインループ（`main.py`内）で定期的に実行される構造であると想定されます。

---
Generated at: 2026-01-12 07:02:09 JST
