# cat-github-watcher

**PR Monitoring Tool for GitHub Copilot's Automated Implementation Phase**

<p align="left">
  <a href="README.ja.md"><img src="https://img.shields.io/badge/üáØüáµ-Japanese-red.svg" alt="Japanese"></a>
  <a href="README.md"><img src="https://img.shields.io/badge/üá∫üá∏-English-blue.svg" alt="English"></a>
</p>

*Note: This document is largely AI-generated. It was generated by prompting an agent with an issue.*

## Status
- Currently dogfooding.
- Major bugs have been largely ironed out.
- Frequent breaking changes are expected.
- Memo
  - Initially, implementation was attempted with GitHub Actions, but it was found unsuitable for PR monitoring, so we transitioned to a Python version.
  - The Python version monitors repositories owned by an authenticated GitHub user and performs notifications and actions based on the PR's phase.

## Quick Links
| Item | Link |
|------|--------|
| üìä GitHub Repository | [cat2151/cat-github-watcher](https://github.com/cat2151/cat-github-watcher) |

## Overview

This Python tool monitors the phases of Pull Requests where GitHub Copilot performs automated implementation, executing appropriate notifications and actions at the right time.
It targets repositories owned by an authenticated GitHub user, efficiently monitoring PRs using the GraphQL API.

## Features

- **Automated Monitoring of All User Repositories**: Automatically monitors PRs in all repositories owned by the authenticated GitHub user.
- **GraphQL API Utilization**: Achieves fast monitoring through efficient data retrieval.
- **Phase Detection**: Automatically identifies PR states (phase1: Draft, phase2: Addressing review comments, phase3: Awaiting review, LLM working: Coding agent in progress).
- **Automated Comment Posting**: Automatically posts appropriate comments based on the phase.
- **Automated Draft PR Readiness**: Automatically changes Draft PRs to a Ready state for addressing review comments during phase2.
- **Mobile Notifications**: Uses ntfy.sh to notify mobile devices when phase3 (awaiting review) is detected.
- **Issue List Display**: If all PRs are in "LLM working" state, displays the top 10 issues from repositories with no open PRs.

## Architecture

This tool is a modularized Python application adhering to the Single Responsibility Principle (SRP).

### Directory Structure

```
cat-github-watcher/
‚îú‚îÄ‚îÄ cat-github-watcher.py    # Entry point
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ gh_pr_phase_monitor/
‚îÇ       ‚îú‚îÄ‚îÄ colors.py         # ANSI color codes and styling
‚îÇ       ‚îú‚îÄ‚îÄ config.py         # Configuration loading and parsing
‚îÇ       ‚îú‚îÄ‚îÄ github_client.py  # GitHub API integration
‚îÇ       ‚îú‚îÄ‚îÄ phase_detector.py # PR phase detection logic
‚îÇ       ‚îú‚îÄ‚îÄ comment_manager.py # Comment posting and verification
‚îÇ       ‚îú‚îÄ‚îÄ pr_actions.py     # PR actions (Ready state, browser launch)
‚îÇ       ‚îî‚îÄ‚îÄ main.py           # Main execution loop
‚îî‚îÄ‚îÄ tests/                    # Test files
```

### Phase Detection Logic

The tool identifies the following four phases:

1. **phase1 (Draft state)**: When the PR is in a Draft state and has review requests.
2. **phase2 (Addressing review comments)**: When copilot-pull-request-reviewer has posted review comments, indicating that changes are needed.
3. **phase3 (Awaiting review)**: When copilot-swe-agent has completed changes, and the PR is awaiting human review.
4. **LLM working (Coding agent in progress)**: When none of the above apply (e.g., Copilot is still implementing).

## Usage

### Prerequisites

- Python 3.x is installed.
- GitHub CLI (`gh`) is installed and authenticated.
  ```bash
  gh auth login
  ```

### Setup

1. Clone this repository:
   ```bash
   git clone https://github.com/cat2151/cat-github-watcher.git
   cd cat-github-watcher
   ```

2. Create a configuration file (optional):
   ```bash
   cp config.toml.example config.toml
   ```

3. Edit `config.toml` to configure monitoring interval, ntfy.sh notifications, and Copilot auto-assignment (optional):
   ```toml
   # Check interval (e.g., "30s", "1m", "5m", "1h", "1d")
   interval = "1m"
   
   # ntfy.sh notification settings (optional)
   # Notifications include a clickable action button to open the PR
   [ntfy]
   enabled = false  # Set to true to enable notifications
   topic = "<Enter your ntfy.sh topic name here>"  # Use an unguessable string as anyone can read/write to it
   message = "PR is ready for review: {url}"  # Message template
   priority = 4  # Notification priority (1=lowest, 3=default, 4=high, 5=highest)
   
   # Auto-assign "good first issue" issues to Copilot (optional)
   # When enabled, it will open the issue in your browser and prompt you to press the "Assign to Copilot" button
   # Set automated = true to enable browser automation that automatically clicks the buttons (requires Selenium)
   [assign_to_copilot]
   enabled = false  # Set to true to enable auto-assignment feature
   automated = false  # Set to true to enable browser automation (requires: pip install selenium webdriver-manager)
   wait_seconds = 10  # How long to wait after opening browser before clicking (seconds)
   browser = "edge"  # Browser to use: "edge", "chrome", or "firefox"
   ```

4. (Optional) If you want to use browser automation, install Selenium:
   ```bash
   pip install -r requirements-automation.txt
   ```
   Or:
   ```bash
   pip install selenium webdriver-manager
   ```
   
   Additionally, you need the browser driver for your chosen browser:
   - **Edge**: Pre-installed on Windows 10/11 (no additional installation needed)
   - **Chrome**: ChromeDriver will be automatically downloaded
   - **Firefox**: GeckoDriver will be automatically downloaded
   ```

### Run

Start the tool to begin monitoring:

```bash
python3 cat-github-watcher.py [config.toml]
```

Or run directly as a Python module:

```bash
python3 -m src.gh_pr_phase_monitor.main [config.toml]
```

### Operational Flow

1. **Startup**: When the tool starts, it begins monitoring repositories owned by the authenticated GitHub user.
2. **PR Detection**: Automatically detects repositories with open PRs.
3. **Phase Determination**: Determines the phase of each PR (phase1/2/3, LLM working).
4. **Action Execution**: 
   - **phase1**: No action (waits in Draft state).
   - **phase2**: Changes Draft PRs to a Ready state and posts a comment requesting Copilot to apply changes.
   - **phase3**: Notifies of awaiting review (mobile notification if ntfy.sh is configured, and opens the PR page in the browser).
   - **LLM working**: Waits (if all PRs are in this state, displays issues from repositories with no open PRs).
5. **Iteration**: Continues monitoring at the configured interval.

### Stop

You can stop monitoring with `Ctrl+C`.

## Important Notes

- GitHub CLI (`gh`) must be installed and authenticated.
- This tool assumes integration with GitHub Copilot (specifically copilot-pull-request-reviewer and copilot-swe-agent).
- **Only repositories owned by the authenticated user** are monitored. Organization repositories are not included to keep the tool simple and focused (YAGNI principle).
- Be mindful of API rate limits, as this tool uses the GraphQL API.
- If using ntfy.sh notifications, configure your topic on [ntfy.sh](https://ntfy.sh/) beforehand.

## Testing

The project includes a test suite using pytest:

```bash
pytest tests/
```

## License

MIT License - See the LICENSE file for details.

*Note: The English README.md is automatically generated by GitHub Actions using Gemini's translation based on README.ja.md.*

*Big Brother is watching your repositories. Now it‚Äôs the cat.* üê±