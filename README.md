# cat-github-watcher

**PR monitoring tool for GitHub Copilot's automated implementation phase**

<p align="left">
  <a href="README.ja.md"><img src="https://img.shields.io/badge/ðŸ‡¯ðŸ‡µ-Japanese-red.svg" alt="Japanese"></a>
  <a href="README.md"><img src="https://img.shields.io/badge/ðŸ‡ºðŸ‡¸-English-blue.svg" alt="English"></a>
</p>

*This document is largely AI-generated. It was generated by prompting an agent with an issue.*

## Status
- Currently dogfooding.
- Major bugs have been addressed.
- Frequent breaking changes are expected.
- Memo
  - Initially, implementation was attempted with GitHub Actions, but it proved unsuitable for PR monitoring, so we transitioned to a Python version.
  - The Python version monitors user-owned repositories of authenticated GitHub users and performs notifications and actions based on the PR's phase.

## Quick Links
| Item | Link |
|------|--------|
| ðŸ“Š GitHub Repository | [cat2151/cat-github-watcher](https://github.com/cat2151/cat-github-watcher) |

## Overview

This Python tool monitors the phases of Pull Requests (PRs) undergoing automated implementation by GitHub Copilot, executing appropriate notifications and actions at the right time.
It efficiently monitors PRs using the GraphQL API, targeting user-owned repositories of authenticated GitHub users.

## Features

- **Automated monitoring of all repositories**: Automatically monitors PRs in user-owned repositories of authenticated GitHub users.
- **GraphQL API utilization**: Achieves fast monitoring with efficient data retrieval.
- **Phase detection**: Automatically determines PR status (phase1: Draft state, phase2: Addressing review comments, phase3: Awaiting review, LLM working: Coding agent in progress).
- **Automated comment posting**: Posts appropriate comments automatically based on the phase.
- **Automated Draft PR readiness**: Automatically changes Draft PRs to a Ready state for addressing review comments in phase2.
- **Mobile notification**: Utilizes ntfy.sh to send notifications to mobile devices when phase3 (awaiting review) is detected.
- **Issue list display**: If all PRs are "LLM working", displays the top 10 issues for repositories without open PRs.

## Architecture

This tool is a Python application modularized according to the Single Responsibility Principle (SRP).

### Directory Structure

```
cat-github-watcher/
â”œâ”€â”€ cat-github-watcher.py    # Entry point
â”œâ”€â”€ src/
â”‚   â””â”€â”€ gh_pr_phase_monitor/
â”‚       â”œâ”€â”€ colors.py         # ANSI color codes and coloring
â”‚       â”œâ”€â”€ config.py         # Configuration loading and parsing
â”‚       â”œâ”€â”€ github_client.py  # GitHub API integration
â”‚       â”œâ”€â”€ phase_detector.py # PR phase detection logic
â”‚       â”œâ”€â”€ comment_manager.py # Comment posting and verification
â”‚       â”œâ”€â”€ pr_actions.py     # PR actions (Ready-up, browser launch)
â”‚       â””â”€â”€ main.py           # Main execution loop
â””â”€â”€ tests/                    # Test files
```

### Phase Detection Logic

The tool detects the following four phases:

1. **phase1 (Draft state)**: When a PR is in Draft state and has review requests.
2. **phase2 (Addressing review comments)**: When `copilot-pull-request-reviewer` has posted review comments and corrections are needed.
3. **phase3 (Awaiting review)**: When `copilot-swe-agent` has completed corrections and is awaiting human review.
4. **LLM working (Coding agent in progress)**: When none of the above apply (e.g., Copilot is implementing).

## Usage

### Prerequisites

- Python 3.x is installed.
- GitHub CLI (`gh`) is installed and authenticated.
  ```bash
  gh auth login
  ```

### Setup

1. Clone this repository:
   ```bash
   git clone https://github.com/cat2151/cat-github-watcher.git
   cd cat-github-watcher
   ```

2. Create a configuration file (optional):
   ```bash
   cp config.toml.example config.toml
   ```

3. Edit `config.toml` to configure the monitoring interval and ntfy.sh notifications (optional):
   ```toml
   # Check interval (e.g., "30s", "1m", "5m", "1h", "1d")
   interval = "1m"
   
   # ntfy.sh notification settings (optional)
   # Notifications include a clickable action button to open the PR
   [ntfy]
   enabled = false  # Set to true to enable notifications
   topic = "cat-github-watcher"  # ntfy.sh topic name
   message = "PR is ready for review: {url}"  # Message template
   priority = 4  # Notification priority (1=lowest, 3=default, 4=high, 5=highest)
   ```

### Execution

Start the tool to begin monitoring:

```bash
python3 cat-github-watcher.py [config.toml]
```

Or, run directly as a Python module:

```bash
python3 -m src.gh_pr_phase_monitor.main [config.toml]
```

### Workflow

1. **Start**: Upon launching the tool, it begins monitoring user-owned repositories of the authenticated GitHub user.
2. **PR Detection**: Automatically detects repositories with open PRs.
3. **Phase Determination**: Determines the phase of each PR (phase1/2/3, LLM working).
4. **Action Execution**:
   - **phase1**: Does nothing (waits in Draft state).
   - **phase2**: Changes the Draft PR to a Ready state and posts a comment requesting Copilot to apply changes.
   - **phase3**: Notifies of awaiting review (mobile notification if ntfy.sh is configured, opens the PR page in the browser).
   - **LLM working**: Waits (if all PRs are in this state, displays issues from repositories without open PRs).
5. **Repeat**: Continues monitoring at the configured interval.

### Stopping

You can stop monitoring by pressing `Ctrl+C`.

## Notes

- GitHub CLI (`gh`) must be installed and authenticated.
- This tool assumes integration with GitHub Copilot (specifically `copilot-pull-request-reviewer` and `copilot-swe-agent`).
- Only **user-owned repositories** of the authenticated user are monitored. Organization repositories are not included to keep the tool simple and focused (YAGNI principle).
- Be mindful of API rate limits when using the GraphQL API.
- If using ntfy.sh notifications, please configure a topic on [ntfy.sh](https://ntfy.sh/) beforehand.

## Tests

The project includes a test suite using pytest:

```bash
pytest tests/
```

## License

MIT License - See the LICENSE file for details.

*The English `README.md` is automatically generated by GitHub Actions using Gemini's translation based on `README.ja.md`.*

*GitHub Copilot watches your PR phases. Now you can focus on coding. ðŸ¤–*