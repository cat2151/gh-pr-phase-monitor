# GitHub PR Phase Monitor Configuration

# Check interval - how often to check the repositories
# Supported formats:
#   - "30s" = 30 seconds
#   - "1m"  = 1 minute
#   - "5m"  = 5 minutes
#   - "1h"  = 1 hour
#   - "1d"  = 1 day
interval = "1m" # default

# Number of issues to display from repositories without open PRs
# Default is 10, but can be changed to any positive number (e.g., 5, 15, 20)
issue_display_limit = 10

# Timeout for "no state change" condition
# If the overall PR state (all PR phases) does not change for this duration,
# the monitoring interval will be switched to reduced frequency mode (see below).
# Set to empty string "" to disable.
# Supported formats: "30s", "1m", "5m", "30m", "1h", "1d"
# Default: "30m" (30 minutes - safety priority)
no_change_timeout = "30m"

# Reduced frequency monitoring interval
# When no state change is detected for the no_change_timeout duration,
# monitoring switches to this interval to reduce API usage.
# When changes are detected, monitoring returns to the normal interval.
# Supported formats: "30s", "1m", "5m", "30m", "1h", "1d"
# Default: "1h" (1 hour)
reduced_frequency_interval = "1h"

# Maximum number of parallel PRs in "LLM working" state
# When there are too many PRs being worked on by Copilot simultaneously,
# auto-assignment of new issues will be paused to avoid API rate limits.
# This prevents automation from stopping due to rate limit errors.
# Default: 3
max_llm_working_parallel = 3

# Check for cat-window-watcher process before raising browser window
# When enabled (true), checks if cat-window-watcher process is running.
# If it is running, browser windows will NOT be raised to foreground to avoid
# interfering with window management automation.
# This prevents auto-assign from failing when cat-window-watcher is active.
# Default: true
check_process_before_autoraise = true

# Verbose mode - Print detailed configuration information
# When enabled, prints all settings at startup and per-repository settings during execution
# This helps detect configuration mistakes
# Default: false
verbose = false

# Note: This tool monitors user-owned repositories under the current GitHub user account
# It uses GraphQL API to efficiently fetch all repositories with open PRs
# Organization repositories are NOT included (YAGNI principle - keeping it simple)
# No need to specify repository directories!

# Rulesets - Configure execution settings per repository or group of repositories
# Rulesets are applied in order, with later rulesets overriding earlier ones
# Each ruleset can specify different execution settings for different repositories
#
# IMPORTANT: Execution control flags (enable_execution_*) can ONLY be specified
# inside [[rulesets]] sections. Global flags are no longer supported.
# Use 'repositories = ["all"]' to apply settings to all repositories.
#
# You can also configure phase3_merge and assign_to_copilot settings per ruleset,
# allowing different repositories to have different merge or auto-assign behaviors.
#
# Example configurations:
#
# [[rulesets]]
# name = "Simple: Auto-assign good first issues to Copilot"
# repositories = ["my-repo"]
# assign_good_first_old = true  # That's it! No [assign_to_copilot] section needed.
#                               # Default: Opens issue in browser for manual assignment
#
# [[rulesets]]
# name = "All repositories default - dry-run mode"
# repositories = ["all"]  # "all" matches all repositories
# enable_execution_phase1_to_phase2 = false  # Set to true to mark draft PRs as ready
# enable_execution_phase2_to_phase3 = false  # Set to true to post phase2 comments
# enable_execution_phase3_send_ntfy = false  # Set to true to send ntfy notifications
# enable_execution_phase3_to_merge = false   # Set to true to merge phase3 PRs
#
# [[rulesets]]
# name = "Enable automation for test repository"
# repositories = ["test-repo"]  # Specify repository by name only
# enable_execution_phase1_to_phase2 = true
# enable_execution_phase2_to_phase3 = true
# enable_execution_phase3_send_ntfy = true
# enable_execution_phase3_to_merge = true
#
# [[rulesets]]
# name = "Enable only notifications for production repos"
# repositories = ["prod-repo1", "prod-repo2"]  # Multiple repositories
# enable_execution_phase1_to_phase2 = false
# enable_execution_phase2_to_phase3 = false
# enable_execution_phase3_send_ntfy = true
# enable_execution_phase3_to_merge = false
#
# [[rulesets]]
# name = "Example with repo name"
# repositories = ["my-repo"]  # Matches any repository named "my-repo"
# enable_execution_phase1_to_phase2 = true
# enable_execution_phase3_to_merge = true
#
# Per-ruleset phase3_merge and assign_to_copilot configuration:
#
# IMPORTANT: For safety, phase3_merge and auto-assign features are DISABLED by default.
# You must explicitly enable them per repository using rulesets.
# When enabled via ruleset, the feature uses the global settings defined in 
# [phase3_merge] and [assign_to_copilot] sections (see below).
# If those global sections are not defined, sensible defaults are used automatically.
#
# [[rulesets]]
# name = "Enable merge for specific repo"
# repositories = ["test-repo"]
# enable_execution_phase3_to_merge = true
#
# [[rulesets]]
# name = "Enable auto-assign for another repo - SIMPLE EXAMPLE"
# repositories = ["another-repo"]
# assign_good_first_old = true     # Assign one old "good first issue" (oldest by issue number, default: false)
#                                  # This is all you need! The [assign_to_copilot] section below is optional.
#                                  # Default behavior: Opens issue in browser for manual assignment
#
# [[rulesets]]
# name = "Enable auto-assign with both flags"
# repositories = ["yet-another-repo"]
# assign_good_first_old = true     # Assign one old "good first issue" (oldest by issue number)
# assign_old = false               # Assign one old issue (oldest by issue number, any label)
#                                  # When both are true, prioritize "good first issue"


# ntfy.sh notification settings (optional)
# Sends mobile notifications when phase3 is detected
# Notifications include a clickable action button to open the PR
[ntfy]
enabled = false  # Set to true to enable notifications
topic = "<your-ntfy.sh-topic-name>" # Use a hard-to-guess topic name for security
message = "PR is ready for review: {url}"  # Message template, {url} will be replaced with PR URL
priority = 4  # Optional: notification priority (1=min, 3=default, 4=high, 5=max)
all_phase3_message = "All PRs are now in phase3 (ready for review)"  # Message when all PRs become phase3

# Phase3 merge settings (optional)
# Automatically merge PRs when they reach phase3 (ready for review)
# Before merging, a comment defined below will be posted to the PR
# IMPORTANT: Feature is DISABLED by default for safety.
# Must be explicitly enabled per repository using enable_execution_phase3_to_merge in rulesets.
# IMPORTANT: When auto-merge is enabled, you MUST explicitly configure the comment field.
[phase3_merge]
comment = "agentによって、レビュー指摘対応が完了したと判断します。userの責任のもと、userレビューは省略します。PRをMergeします。"  # Comment to post before merging (REQUIRED when auto-merge is enabled)
automated = false  # Set to true to use browser automation to click the merge button
wait_seconds = 10  # How long to wait after opening the browser before clicking (automated mode only)
# Note: Feature branch is automatically deleted after successful merge

# Auto-assign issues to Copilot (optional - this entire section is optional!)
# 
# SIMPLE USAGE: Just set assign_good_first_old = true in a ruleset (see examples above)
# This section only needs to be defined if you want to customize the default behavior.
# 
# Assignment behavior is controlled by ruleset flags:
# - assign_good_first_old: Assign one old "good first issue" (oldest by issue number, default: false)
# - assign_old: Assign one old issue (oldest by issue number, any label, default: false)
# When both are true, prioritize "good first issue"
# 
# Default behavior (when this section is not defined):
# - Uses PyAutoGUI to automatically click buttons
# - wait_seconds = 10
# 
# Required: Install PyAutoGUI:
#   Install: pip install pyautogui pillow
# 
# IMPORTANT: Feature is DISABLED by default for safety.
# Must be explicitly enabled per repository using assign_good_first_old or assign_old in rulesets.
[assign_to_copilot]
wait_seconds = 10  # How long to wait after opening the browser before clicking
